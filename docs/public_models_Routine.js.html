<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/models/Routine.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/models/Routine.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const Sequelize = require('sequelize');
const db = require('./database');

/**
 * Modelo de usuário para interação com a tabela de usuários.
 * @const {UserModel}
 */
const { UserModel } = require('./User');

/**
 * Classe que representa a rotina de treino. A partir dela as rotinas de treino sao criadas e salvas.
 */
class Routine {
    #name;
    #focus;
    #exercises;
    #feedback = 0;
    #userId;

    /**
     * Construtor das rotinas.
     * @constructor
     * @param {string} name Nome da rotina.
     * @param {string} focus Gropo muscular escolhido para a rotina.
     * @param {int} userId Id do usuário que criou a rotina.
     */
    constructor(name, focus, userId) {
        this.#name = name;
        this.#focus = focus;
        this.#userId = userId;
    }

    get name() {
        return this.#name;
    }

    set name(value) {
        this.#name = value;
    }

    get focus() {
        return this.#focus;
    }

    set focus(value) {
        this.#focus = value;
    }

    get exercises() {
        return this.#exercises;
    }

    set exercises(value) {
        this.#exercises = value;
    }

    get feedback() {
        return this.#feedback;
    }

    set feedback(value) {
        this.#feedback = value;
    }

    get userId() {
        return this.#userId;
    }

    set userId(value) {
        this.#userId = value;
    }

    /**
    * Obtém os exercícios associados a este modelo.
    * @async
    * @returns {Promise&lt;Array>} Uma Promise que resolve para um array de exercícios associados a este modelo.
    */
    async getExercises() {
        return this.sequelizeModel.getExercises();
    }

    /**
    * Define os exercícios associados a este modelo.
    * @async
    * @param {Array} exercises - Um array de exercícios a serem associados a este modelo.
    * @returns {Promise&lt;void>} Uma Promise que resolve quando os exercícios são definidos com sucesso.
    */
    async setExercises(exercises) {
        return this.sequelizeModel.setExercises(exercises);
    }

    /**
    * Cria uma nova rotina de treino no banco de dados.
    * @async
    * @param {Object} newRoutine - Objeto contendo os detalhes da nova rotina de treino.
    * @returns {Promise&lt;Object>} Uma Promise que resolve para a rotina de treino criada.
    * @throws {Error} Lança um erro se houver algum problema ao inserir a rotina no banco de dados.
    */
    static async create(newRoutine) {
        try {
            const routine = await db.models.Routine.create({
                name: newRoutine.name,
                focus: newRoutine.focus,
                userId: newRoutine.userId
            });
            console.log('Treino inserido no banco de dados:', routine.name);
            return routine;
        } catch (error) {
            console.error('Erro ao inserir treino no banco de dados:', error);
            throw error;
        }
    }

    /**
     * Função assíncrona para encontrar a rotina com base no id do usuário.
     * @async
     * @param {int} userId Id do usuário.
     * @returns Objeto da rotina.
     * @throws {Error} Lança um erro se houver algum problema ao buscar a rotina de treino.
     */
    static async findByUserId(userId) {
        try {
            const routines = await db.models.Routine.findAll({
                where: {
                    userId: userId
                }
            });

            return routines;
        } catch (error) {
            console.error('Erro ao buscar rotinas pelo ID do usuário:', error);
            throw error;
        }
    }

    /**
     * Função assíncrona para encontrar a rotina com base no id do usuário e no id da rotina.
     * @async
     * @param {int} userId Id do usuário.
     * @param {int} routineId Id da rotina.
     * @returns Objeto da rotina.
     * @throws {Error} Lança um erro se houver algum problema ao buscar a rotina de treino.
     */
    static async findByUserIdAndRoutineId(userId, routineId) {
        try {
            const routine = await db.models.Routine.findOne({
                where: {
                    userId: userId,
                    id: routineId
                }
            });

            return routine;
        } catch (error) {
            console.error('Erro ao buscar rotina pelo ID do usuário e ID da rotina:', error);
            throw error;
        }
    }

    /**
    * Exclui uma rotina de treino associada a um usuário.
    * @async
    * @param {int} userId - O ID do usuário proprietário da rotina de treino.
    * @param {int} routineId - O ID da rotina de treino a ser excluída.
    * @throws {Error} Lança um erro se houver algum problema ao excluir a rotina de treino.
    */
    static async deleteRoutine(userId, routineId) {
        try {
            const response = await fetch(`/user-routine/${userId}/${routineId}`, {
                method: 'DELETE'
            });
            if (response.ok) {
                const data = await response.json();
                console.log(data.message);
            } else {
                console.error('Erro ao excluir treino:', response.status);
            }
        } catch (error) {
            console.error('Erro ao excluir treino:', error);
        }
    }

    /**
    * Atualiza uma rotina de treino no banco de dados.
    * @async
    * @param {Object} routine - Objeto contendo os detalhes da rotina de treino a ser atualizada.
    * @returns {Promise&lt;number>} Uma Promise que resolve para o número de linhas atualizadas no banco de dados.
    * @throws {Error} Lança um erro se houver algum problema ao atualizar a rotina de treino.
    */
    static async update(routine) {
        try {
            const updatedRoutine = await db.models.Routine.update(routine.routine, {
                where: {
                    id: routine.routine.id
                }
            });
    
            console.log('Rotina atualizada no banco de dados:', updatedRoutine);
            return updatedRoutine;
        } catch (error) {
            console.error('Erro ao atualizar rotina no banco de dados:', error);
            throw error;
        }
    }
    
    /**
    * Incrementa o contador de vezes que a rotina foi realizada.
    * @async
    * @param {Object} routine - Objeto contendo os detalhes da rotina de treino.
    * @returns {Promise&lt;Object>} Uma Promise que resolve para o objeto da rotina de treino atualizado com o contador incrementado.
    * @throws {Error} Lança um erro se houver algum problema ao incrementar o contador.
    */
    async incrementCompletedCount(routine) {
        try {
            routine.feedback = routine.feedback + 1;
            return routine;
        } catch (error) {
            console.error('Erro ao incrementar quantidade de treinos concluídos:', error);
            throw error;
        }
    }

}

/**
 * Modelo de tabela para rotinas de treino.
 * @typedef {Object} RoutineModel
 * @property {int} id - Identificador único da rotina de treino.
 * @property {string} name - Nome da rotina de treino.
 * @property {string} focus - Grupo muscular da rotina de treino.
 * @property {int|null} feedback - Contador de quantas vezes a rotina foi realizada.
 * @property {int} userId - ID do usuário ao qual a rotina de treino está associada.
 */
const RoutineModel = db.define('Routine', {
    id: {
        type: Sequelize.INTEGER,
        autoIncrement: true,
        allowNull: false,
        primaryKey: true
    },
    name: {
        type: Sequelize.STRING,
        allowNull: false
    },
    focus: {
        type: Sequelize.STRING,
        allowNull: false
    },
    feedback: {
        type: Sequelize.INTEGER,
        allowNull: true
    },
    userId: {
        type: Sequelize.INTEGER,
        allowNull: false,
        references: {
            model: UserModel,
            key: 'id'
        },
        onDelete: 'CASCADE'
    }
}, {
    tableName: 'routines'
});

//Syncando a model com o banco de dados
RoutineModel.sync();
RoutineModel.belongsTo(UserModel, { foreignKey: 'userId' });
module.exports = { Routine, RoutineModel };

const { ExerciseModel } = require('./Exercise');
RoutineModel.hasMany(ExerciseModel, { foreignKey: 'routineId' });

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CalorieCalculator.html">CalorieCalculator</a></li><li><a href="Diet.html">Diet</a></li><li><a href="DietIngredient.html">DietIngredient</a></li><li><a href="Exercise.html">Exercise</a></li><li><a href="Ingredient.html">Ingredient</a></li><li><a href="Routine.html">Routine</a></li><li><a href="User.html">User</a></li><li><a href="WaterIntakeCalculator.html">WaterIntakeCalculator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Sequelize">Sequelize</a></li><li><a href="global.html#addOrEnterDiet">addOrEnterDiet</a></li><li><a href="global.html#addOrEnterRoutine">addOrEnterRoutine</a></li><li><a href="global.html#adicionarIngrediente">adicionarIngrediente</a></li><li><a href="global.html#clearStorage">clearStorage</a></li><li><a href="global.html#contabilizarTreino">contabilizarTreino</a></li><li><a href="global.html#createDiet">createDiet</a></li><li><a href="global.html#createRoutine">createRoutine</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#diets">diets</a></li><li><a href="global.html#exercises">exercises</a></li><li><a href="global.html#formContainer">formContainer</a></li><li><a href="global.html#getIngredientDetails">getIngredientDetails</a></li><li><a href="global.html#getIngredients">getIngredients</a></li><li><a href="global.html#handleCheckboxClick">handleCheckboxClick</a></li><li><a href="global.html#handleLogin">handleLogin</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#ingredientesSelecionados">ingredientesSelecionados</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#loginForm">loginForm</a></li><li><a href="global.html#mockDiets">mockDiets</a></li><li><a href="global.html#removeDiet">removeDiet</a></li><li><a href="global.html#removeRoutine">removeRoutine</a></li><li><a href="global.html#removerIngrediente">removerIngrediente</a></li><li><a href="global.html#signUpForm">signUpForm</a></li><li><a href="global.html#switchForms">switchForms</a></li><li><a href="global.html#totalCalorias">totalCalorias</a></li><li><a href="global.html#updateDiet">updateDiet</a></li><li><a href="global.html#user">user</a></li><li><a href="global.html#userString">userString</a></li><li><a href="global.html#verificarTodosMarcados">verificarTodosMarcados</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sat Apr 06 2024 19:25:23 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
