<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/js/controller/homeController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/js/controller/homeController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { addOrEnterRoutine } from './routineController.js';
import { addOrEnterDiet } from './dietController.js';
const userString = localStorage.getItem('user');
const user = JSON.parse(userString);

console.log(user);


/**
 * Função que preenche os dados do usuário caso correspondam no Banco de dados.
 * @async
 */
async function fillUserData() {
    for (var key in user) {
        if (user.hasOwnProperty(key)) {
            var inputElement = document.getElementById(key);
            if (inputElement) {
                inputElement.value = user[key];
            }
        }
    }
    var textAreaElement = document.getElementById('bio');
    textAreaElement.value = user.bio;

    //verificar se tem treino e criar os elementos
    fetch('/user-routines/' + user.id)
    .then(response => response.json())
    .then(treinos => {
        const panelUserWorkout = document.getElementById('userWorkout');
        if (treinos.length > 0) {
            treinos.forEach(treino => {
                // Criar a div do treino
                var divTreino = document.createElement('div');
                divTreino.classList.add('routines');
                divTreino.setAttribute('data-treino-id', treino.id);
                divTreino.addEventListener('click', () => addOrEnterRoutine(true, treino.id));

                //Adicionar o nome do treino
                var treinoName = document.createElement('span');
                treinoName.textContent = treino.name;
                divTreino.appendChild(treinoName);

                //Adicionando o focus do treino
                var treinoFocus = document.createElement('span');
                treinoFocus.textContent = treino.focus.toUpperCase();
                divTreino.appendChild(treinoFocus);

                // Adicionar o ícone de exclusão
                var icon = document.createElement('i');
                icon.classList.add('fas', 'fa-times', 'remove-icon');
                icon.addEventListener('click', (event) => {
                    event.stopPropagation();
                    removeRoutine(treino.id);
                });

                //Adicionando o feedback do treino
                var treinoFeedback = document.createElement('span');
                treinoFeedback.classList.add('workout-feedback');
                treinoFeedback.textContent = treino.feedback ? treino.feedback + 'x' : '0x';
                divTreino.appendChild(treinoFeedback);

                divTreino.appendChild(icon);
                
                panelUserWorkout.appendChild(divTreino);
            });
        } else {
            console.log('Usuário não tem treinos associados.');
        }
        
    })

    // verificar se o usuário tem dietas associadas
    fetch('/user-diets/' + user.id)
    .then(response => response.json())
    .then(dietas => {
        const panelUserWorkout = document.getElementById('dietList');
        if (dietas.length > 0) {
            dietas.forEach(diet => {
                // Criar a div da dieta
                var divDiet = document.createElement('div');
                divDiet.classList.add('diets');
                divDiet.setAttribute('data-diet-id', diet.id);
                divDiet.addEventListener('click', () => addOrEnterDiet(true, diet.id));

                //Adicionar o nome da dieta
                var dietName = document.createElement('span');
                dietName.textContent = diet.name;
                divDiet.appendChild(dietName);

                //Adicionando o focus da dieta
                var dietFocus = document.createElement('span');
                dietFocus.textContent = diet.focus.toUpperCase();
                divDiet.appendChild(dietFocus);

                // Adicionar o ícone de exclusão
                var icon = document.createElement('i');
                icon.classList.add('fas', 'fa-times', 'remove-icon');
                icon.addEventListener('click', (event) => {
                    event.stopPropagation();
                    removeDiet(diet.id);
                });

                //Adicionando o feedback do treino
                var dietCalories = document.createElement('span');
                dietCalories.classList.add('diet-calories');
                dietCalories.textContent = diet.calories > 0 ? diet.calories + 'kcal' : '0kcal';
                dietCalories.setAttribute('id', `diet-calories-${diet.name}`);
                divDiet.appendChild(dietCalories);

                divDiet.appendChild(icon);
                
                panelUserWorkout.appendChild(divDiet);
            });
        } else {
            console.log('Usuário não tem dietas associadas.');
        }
        
    })
    .catch(error => {
        console.error('Erro ao buscar dietas do usuário:', error);
    });

    await getUserById().then(function(foundedUser) {
        calculateAverageCalories(user.age, user.height, user.weight, foundedUser.activity);

        var genderSelect = document.getElementById('gender');
        genderSelect.value = foundedUser.gender;

        var activitySelect = document.getElementById('activity');
        activitySelect.value = foundedUser.activity;
    });
}

/**
 * Obtém os dados dos campos de entrada do formulário.
 * @returns {Object} Um objeto contendo os dados dos campos de entrada do formulário.
 */
function getDataFromInputs() {
    var userData = {};
    var inputs = document.getElementsByTagName('input');
    var bio = document.getElementById('bio').value;
    var gender = document.getElementById('gender').value;
    var activity = document.getElementById('activity').value;

    for (var i = 0; i &lt; inputs.length; i++) {
        var input = inputs[i];
        var key = input.id; 

        
        if (key) {
            userData[key] = input.value;
        }
    }
    userData['bio'] = bio;
    userData['id'] = user.id;
    userData['username'] = user.username;
    userData['password'] = user.password;
    userData['gender'] = gender;
    userData['activity'] = activity;
    return userData;
}

/**
 * Busca um usuário pelo seu ID.
 * @returns {Promise&lt;Object>} Uma Promise que resolve para o objeto do usuário encontrado.
 * @throws {Error} Se ocorrer um erro ao buscar o usuário pelo ID.
 */
const getUserById = async function() {
    try {
        const response = await fetch(`/get-user/${user.id}`);
        if (!response.ok) {
            throw new Error('Erro ao buscar usuário pelo ID');
        }
        const foundedUser = await response.json();
        return foundedUser;
    } catch (error) {
        console.error('Erro ao buscar usuário pelo ID:', error);
        throw error;
    }
}

/**
 * Salva os dados do usuário.
 */
const saveData = function () {
    var userData = getDataFromInputs();
    const {name, username, email, password, age, weight, id, height, birth, bio, gender, activity} = userData;
    const loadingSwal = Swal.fire({
        title: 'Carregando...',
        allowOutsideClick: false, 
        showConfirmButton: false, 
        didOpen: () => {
            Swal.showLoading(); 
        }
    });
    
    fetch('/update-user', {
        method: 'post',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            name: name,
            username: username,
            email: email, 
            password: password,
            age: age, 
            weight: weight,
            id: id, 
            height: height,
            birth: birth, 
            bio: bio,
            gender: gender,
            activity: activity
        })
    }).then(res => res.json())
        .then(data => {
            loadingSwal.close();
            localStorage.removeItem('user');
            localStorage.setItem('user', JSON.stringify(userData));
            Swal.fire("Dados atualizados!", "", "success").then(function() {
                location.reload();
                window.location.href = 'home#userData';
            });
        })
        .catch(error => {
            console.error('Erro:', error);
        });
}

/**
 * Preenche as informações adicionais do perfil do usuário, como IMC e ingestão de água.
 * @param {Array} data - Array contendo as informações adicionais do perfil, onde o índice 8 contém o IMC e o índice 9 contém a ingestão de água.
 */
const fillAditionalInfo = function(data) {
    var imc = data[8].imc;
    var waterIntake = data[9].waterIntake;

    // Preenchendo informações adicionais do perfil
    var waterIntakeDiv = document.getElementById('water-intake-block');
    waterIntakeDiv.innerHTML = `
        &lt;i class="fa fa-coffee" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Água&lt;/label> 
        &lt;span>${waterIntake.toFixed(0)}ml&lt;/span>`;

    var imcDiv = document.getElementById('imc-block');
    imcDiv.innerHTML = `
        &lt;i class="fa fa-balance-scale" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">IMC&lt;/label> 
        &lt;span>${imc.toFixed(2)}&lt;/span>`;
}

/**
 * Preenche as informações calóricas do perfil da dieta na interface de dietas.
 * @param {Array} data - Array contendo as informações calóricas do perfil da dieta, tanto para homens, quanto para mulheres.
 */
const fillCaloriesParameters = function(data) {
    console.log(data);
    var TMBMale = data[0].TMBMale;
    var TMBFemale = data[1].TMBFemale;
    var weightLossMale = data[2].weightLossMale;
    var weightLossFemale = data[3].weightLossFemale;
    var massGainMale = data[4].massGainMale;
    var massGainFemale = data[5].massGainFemale;
    var maintanceMale = data[6].maintanceMale;
    var maintanceFemale = data[7].maintanceFemale;
    var imc = data[8].imc;
    var waterIntake = data[9].waterIntake;

    // Preenchendo informações calóricas do perfil da dieta
    var TMBMaleDiv = document.getElementById('tmb-male');
    TMBMaleDiv.innerHTML = `
        &lt;i class="fa fa-mars" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">TMB&lt;/label> 
        &lt;span>${TMBMale.toFixed(0)} kcal&lt;/span>`;

    var TMBFemaleDiv = document.getElementById('tmb-female');
    TMBFemaleDiv.innerHTML = `
        &lt;i class="fa fa-venus" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">TMB&lt;/label> 
        &lt;span>${TMBFemale.toFixed(0)} kcal&lt;/span>`;

    var imcDiv = document.getElementById('calorie-for-imc');
    imcDiv.innerHTML = `
        &lt;i class="fa fa-balance-scale" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">IMC&lt;/label> 
        &lt;span>${imc.toFixed(2)}&lt;/span>`;

    var imcDiv = document.getElementById('calorie-for-water');
    imcDiv.innerHTML = `
        &lt;i class="fa fa-coffee" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Água&lt;/label> 
        &lt;span>${waterIntake.toFixed(0)} ml&lt;/span>`;

    var WLMaleDiv = document.getElementById('calorie-for-weightloss-male');
    WLMaleDiv.innerHTML = `
        &lt;i class="fa fa-mars" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Emagrecimento&lt;/label> 
        &lt;span>${weightLossMale.toFixed(0)} kcal&lt;/span>`;

    var WLFemaleDiv = document.getElementById('calorie-for-weightloss-female');
    WLFemaleDiv.innerHTML = `
        &lt;i class="fa fa-venus" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Emagrecimento&lt;/label> 
        &lt;span>${weightLossFemale.toFixed(0)} kcal&lt;/span>`;

    var MGMaleDiv = document.getElementById('calorie-for-massgain-male');
    MGMaleDiv.innerHTML = `
        &lt;i class="fa fa-mars" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Hipertrofia&lt;/label> 
        &lt;span>${massGainMale.toFixed(0)} kcal&lt;/span>`;

    var MGFemaleDiv = document.getElementById('calorie-for-massgain-female');
    MGFemaleDiv.innerHTML = `
        &lt;i class="fa fa-venus" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Hipertrofia&lt;/label> 
        &lt;span>${massGainFemale.toFixed(0)} kcal&lt;/span>`;

    var MaintanceMaleDiv = document.getElementById('calorie-for-maintance-male');
    MaintanceMaleDiv.innerHTML = `
        &lt;i class="fa fa-mars" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Definição (manter)&lt;/label> 
        &lt;span>${maintanceMale.toFixed(0)} kcal&lt;/span>`;

    var MaintanceFemaleDiv = document.getElementById('calorie-for-maintance-female');
    MaintanceFemaleDiv.innerHTML = `
        &lt;i class="fa fa-venus" aria-hidden="true" style="color: #000">&lt;/i> 
        &lt;label style="color: #000">Definição (manter)&lt;/label> 
        &lt;span>${maintanceFemale.toFixed(0)} kcal&lt;/span>`;
}

/**
 * Calcula as calorias médias com base na idade, altura, peso e nível de atividade fornecidos,
 * e preenche as informações adicionais e parâmetros de calorias na interface de dietas e usuário.
 * @param {int} age - Idade do usuário.
 * @param {float} height - Altura do usuário em metros.
 * @param {float} weight - Peso do usuário em quilogramas.
 * @param {string} activity - Nível de atividade do usuário (sedentário, moderado, ativo).
 * @throws {Error} Se houver um erro ao calcular as calorias médias.
 */
const calculateAverageCalories = async function(age, height, weight, activity) {
    try {
        const response = await fetch('/calculate-calories', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ age, height, weight, activity })
        });

        if (!response.ok) {
            throw new Error('Erro ao calcular calorias médias');
        }

        const data = await response.json();
        fillAditionalInfo(data);
        fillCaloriesParameters(data);
    } catch (error) {
        console.error('Erro ao calcular calorias médias:', error);
        throw error;
    }
}

/**
 * Inicializa a aplicação preenchendo os dados do usuário, e define as funções globais 
 * para salvar dados do usuário, adicionar ou entrar em uma rotina, e calcular as calorias médias.
 */
function init () {
    fillUserData();
    window.saveData = saveData;
    window.addOrEnterRoutine = addOrEnterRoutine;
    window.calculateAverageCalories = calculateAverageCalories;
}

init();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CalorieCalculator.html">CalorieCalculator</a></li><li><a href="Diet.html">Diet</a></li><li><a href="DietIngredient.html">DietIngredient</a></li><li><a href="Exercise.html">Exercise</a></li><li><a href="Ingredient.html">Ingredient</a></li><li><a href="Routine.html">Routine</a></li><li><a href="User.html">User</a></li><li><a href="WaterIntakeCalculator.html">WaterIntakeCalculator</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Sequelize">Sequelize</a></li><li><a href="global.html#addOrEnterDiet">addOrEnterDiet</a></li><li><a href="global.html#addOrEnterRoutine">addOrEnterRoutine</a></li><li><a href="global.html#adicionarIngrediente">adicionarIngrediente</a></li><li><a href="global.html#calculateAverageCalories">calculateAverageCalories</a></li><li><a href="global.html#checkAndCreateExampleExercises">checkAndCreateExampleExercises</a></li><li><a href="global.html#clearStorage">clearStorage</a></li><li><a href="global.html#contabilizarTreino">contabilizarTreino</a></li><li><a href="global.html#createDiet">createDiet</a></li><li><a href="global.html#createExampleExercises">createExampleExercises</a></li><li><a href="global.html#createRoutine">createRoutine</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#diets">diets</a></li><li><a href="global.html#exercises">exercises</a></li><li><a href="global.html#fillAditionalInfo">fillAditionalInfo</a></li><li><a href="global.html#fillCaloriesParameters">fillCaloriesParameters</a></li><li><a href="global.html#fillUserData">fillUserData</a></li><li><a href="global.html#formContainer">formContainer</a></li><li><a href="global.html#getDataFromInputs">getDataFromInputs</a></li><li><a href="global.html#getIngredientDetails">getIngredientDetails</a></li><li><a href="global.html#getIngredients">getIngredients</a></li><li><a href="global.html#getUserById">getUserById</a></li><li><a href="global.html#handleCheckboxClick">handleCheckboxClick</a></li><li><a href="global.html#handleLogin">handleLogin</a></li><li><a href="global.html#handleSubmit">handleSubmit</a></li><li><a href="global.html#ingredientesSelecionados">ingredientesSelecionados</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#initializeApp">initializeApp</a></li><li><a href="global.html#loginForm">loginForm</a></li><li><a href="global.html#mockDiets">mockDiets</a></li><li><a href="global.html#removeDiet">removeDiet</a></li><li><a href="global.html#removeRoutine">removeRoutine</a></li><li><a href="global.html#removerIngrediente">removerIngrediente</a></li><li><a href="global.html#saveData">saveData</a></li><li><a href="global.html#signUpForm">signUpForm</a></li><li><a href="global.html#switchForms">switchForms</a></li><li><a href="global.html#totalCalorias">totalCalorias</a></li><li><a href="global.html#updateDiet">updateDiet</a></li><li><a href="global.html#user">user</a></li><li><a href="global.html#userString">userString</a></li><li><a href="global.html#verificarTodosMarcados">verificarTodosMarcados</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Sun Apr 07 2024 17:26:57 GMT-0300 (Horário Padrão de Brasília)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
